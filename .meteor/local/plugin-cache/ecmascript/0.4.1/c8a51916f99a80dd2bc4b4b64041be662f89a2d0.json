{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"/packages/accounts-password/email_tests_setup.js","filenameRelative":"/packages/accounts-password/email_tests_setup.js","env":{},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":false,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/packages/accounts-password/email_tests_setup.js.map","sourceFileName":"/packages/accounts-password/email_tests_setup.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"basename":"email_tests_setup"},"ignored":false,"code":"//\n// a mechanism to intercept emails sent to addressing including\n// the string \"intercept\", storing them in an array that can then\n// be retrieved using the getInterceptedEmails method\n//\nvar interceptedEmails = {}; // (email address) -> (array of options)\n\n// add html email templates that just contain the url\nAccounts.emailTemplates.resetPassword.html = Accounts.emailTemplates.enrollAccount.html = Accounts.emailTemplates.verifyEmail.html = function (user, url) {\n  return url;\n};\n\n// override the from address\nAccounts.emailTemplates.resetPassword.from = Accounts.emailTemplates.enrollAccount.from = Accounts.emailTemplates.verifyEmail.from = function (user) {\n  return 'test@meteor.com';\n};\n\n// add a custom header to check against\nAccounts.emailTemplates.headers = {\n  'My-Custom-Header': 'Cool'\n};\n\nEmailTest.hookSend(function (options) {\n  var to = options.to;\n  if (!to || to.indexOf('intercept') === -1) {\n    return true; // go ahead and send\n  } else {\n      if (!interceptedEmails[to]) interceptedEmails[to] = [];\n\n      interceptedEmails[to].push(options);\n      return false; // skip sending\n    }\n});\n\nMeteor.methods({\n  getInterceptedEmails: function () {\n    function getInterceptedEmails(email) {\n      check(email, String);\n      return interceptedEmails[email];\n    }\n\n    return getInterceptedEmails;\n  }(),\n\n  addEmailForTestAndVerify: function () {\n    function addEmailForTestAndVerify(email) {\n      check(email, String);\n      Meteor.users.update({ _id: this.userId }, { $push: { emails: { address: email, verified: false } } });\n      Accounts.sendVerificationEmail(this.userId, email);\n    }\n\n    return addEmailForTestAndVerify;\n  }(),\n\n  createUserOnServer: function () {\n    function createUserOnServer(email) {\n      check(email, String);\n      var userId = Accounts.createUser({ email: email });\n      Accounts.sendEnrollmentEmail(userId);\n      return Meteor.users.findOne(userId);\n    }\n\n    return createUserOnServer;\n  }()\n});","ast":null,"map":{"version":3,"sources":["/packages/accounts-password/email_tests_setup.js"],"names":[],"mappings":";;;;;AAKA,IAAI,oBAAoB,EAApB;;;AAGJ,SAAS,cAAT,CAAwB,aAAxB,CAAsC,IAAtC,GACE,SAAS,cAAT,CAAwB,aAAxB,CAAsC,IAAtC,GACA,SAAS,cAAT,CAAwB,WAAxB,CAAoC,IAApC,GAA2C,UAAU,IAAV,EAAgB,GAAhB,EAAqB;AAC9D,SAAO,GAAP,CAD8D;CAArB;;;AAK7C,SAAS,cAAT,CAAwB,aAAxB,CAAsC,IAAtC,GACE,SAAS,cAAT,CAAwB,aAAxB,CAAsC,IAAtC,GACE,SAAS,cAAT,CAAwB,WAAxB,CAAoC,IAApC,GAA2C,UAAU,IAAV,EAAgB;AACzD,SAAO,iBAAP,CADyD;CAAhB;;;AAK/C,SAAS,cAAT,CAAwB,OAAxB,GAAkC;AAChC,sBAAqB,MAArB;CADF;;AAIA,UAAU,QAAV,CAAmB,UAAU,OAAV,EAAmB;AACpC,MAAI,KAAK,QAAQ,EAAR,CAD2B;AAEpC,MAAI,CAAC,EAAD,IAAO,GAAG,OAAH,CAAW,WAAX,MAA4B,CAAC,CAAD,EAAI;AACzC,WAAO,IAAP;AADyC,GAA3C,MAEO;AACL,UAAI,CAAC,kBAAkB,EAAlB,CAAD,EACF,kBAAkB,EAAlB,IAAwB,EAAxB,CADF;;AAGA,wBAAkB,EAAlB,EAAsB,IAAtB,CAA2B,OAA3B,EAJK;AAKL,aAAO,KAAP;AALK,KAFP;CAFiB,CAAnB;;AAaA,OAAO,OAAP,CAAe;AACb;AAAsB,kCAAU,KAAV,EAAiB;AACrC,YAAM,KAAN,EAAa,MAAb,EADqC;AAErC,aAAO,kBAAkB,KAAlB,CAAP,CAFqC;KAAjB;;;KAAtB;;AAKA;AAA0B,sCAAU,KAAV,EAAiB;AACzC,YAAM,KAAN,EAAa,MAAb,EADyC;AAEzC,aAAO,KAAP,CAAa,MAAb,CACE,EAAC,KAAK,KAAK,MAAL,EADR,EAEE,EAAC,OAAO,EAAC,QAAQ,EAAC,SAAS,KAAT,EAAgB,UAAU,KAAV,EAAzB,EAAR,EAFH,EAFyC;AAKzC,eAAS,qBAAT,CAA+B,KAAK,MAAL,EAAa,KAA5C,EALyC;KAAjB;;;KAA1B;;AAQA;AAAoB,gCAAU,KAAV,EAAiB;AACnC,YAAM,KAAN,EAAa,MAAb,EADmC;AAEnC,UAAI,SAAS,SAAS,UAAT,CAAoB,EAAC,OAAO,KAAP,EAArB,CAAT,CAF+B;AAGnC,eAAS,mBAAT,CAA6B,MAA7B,EAHmC;AAInC,aAAO,OAAO,KAAP,CAAa,OAAb,CAAqB,MAArB,CAAP,CAJmC;KAAjB;;;KAApB;CAdF","file":"/packages/accounts-password/email_tests_setup.js.map","sourcesContent":["//\n// a mechanism to intercept emails sent to addressing including\n// the string \"intercept\", storing them in an array that can then\n// be retrieved using the getInterceptedEmails method\n//\nvar interceptedEmails = {}; // (email address) -> (array of options)\n\n// add html email templates that just contain the url\nAccounts.emailTemplates.resetPassword.html =\n  Accounts.emailTemplates.enrollAccount.html =\n  Accounts.emailTemplates.verifyEmail.html = function (user, url) {\n    return url;\n  };\n\n// override the from address\nAccounts.emailTemplates.resetPassword.from =\n  Accounts.emailTemplates.enrollAccount.from =\n    Accounts.emailTemplates.verifyEmail.from = function (user) {\n      return 'test@meteor.com';\n    };\n\n// add a custom header to check against\nAccounts.emailTemplates.headers = {\n  'My-Custom-Header' : 'Cool'\n};\n\nEmailTest.hookSend(function (options) {\n  var to = options.to;\n  if (!to || to.indexOf('intercept') === -1) {\n    return true; // go ahead and send\n  } else {\n    if (!interceptedEmails[to])\n      interceptedEmails[to] = [];\n\n    interceptedEmails[to].push(options);\n    return false; // skip sending\n  }\n});\n\nMeteor.methods({\n  getInterceptedEmails: function (email) {\n    check(email, String);\n    return interceptedEmails[email];\n  },\n\n  addEmailForTestAndVerify: function (email) {\n    check(email, String);\n    Meteor.users.update(\n      {_id: this.userId},\n      {$push: {emails: {address: email, verified: false}}});\n    Accounts.sendVerificationEmail(this.userId, email);\n  },\n\n  createUserOnServer: function (email) {\n    check(email, String);\n    var userId = Accounts.createUser({email: email});\n    Accounts.sendEnrollmentEmail(userId);\n    return Meteor.users.findOne(userId);\n  }\n});\n"]},"hash":"c8a51916f99a80dd2bc4b4b64041be662f89a2d0"}
